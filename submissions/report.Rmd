---
title: "US forecasts: weekly review"
output: html_document
---
<style>
.vscroll-plot {
    width: 1000px;
    height: 600px;
    overflow-y: scroll;
    overflow-x: hidden;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(here)
library(dplyr)
source(here("utils", "get-us-data.R"))
source(here("evaluation", "utils", "plot_data.R"))

target_date <- as.Date(readRDS(here::here("data", "target_date.rds"))) 
```

# `r target_date`

## Anomalies

Submission validity checked with the following result:
```{r finalise, message=FALSE}
errors <- readRDS(here("submissions", "utils", paste0(target_date, "-errors.rds")))
print(errors)
```

Be aware of the following states:
```{r anomalies, message = FALSE}
if (file.exists(here("data", "anomalies", paste0(target_date, ".txt")))) {
  anomalies <- suppressMessages(scan(here("data", "anomalies", paste0(target_date, ".txt")), what = "character", sep = ","))
  anomalies <- stringr::str_trim(anomalies)
  print(anomalies)
} else {
  print("No anomalies recorded.")
}
```

----

## Evaluation {.tabset}

### Data {.tabset .tabset-pills}

<div class="vscroll-plot">
  
```{r plot-data}
knitr::include_graphics(here::here("evaluation", "plots",
                                   target_date, "data.png"))
```
</div>

### Forecasts {.tabset .tabset-pills}

<div class="vscroll-plot">
```{r plot-forecasts}
knitr::include_graphics(here::here("evaluation", "plots",
                                   target_date, "forecasts.png"))
```
</div>

---

## Submission
The QRA is submitted by default. Change this for any combination of states/models using [`submissions/utils/swap-ensembles.R`](https://github.com/epiforecasts/covid-us-forecasts/blob/master/submissions/utils/swap-ensembles.R). Specify state/model combinations in the `swap` list, then source the script.



